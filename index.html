<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Hello, Nginx!</title>
    <meta charset="utf-8" />
    <!--<meta http-equiv="Content-Security-Policy" 
    content="default-src *; style-src 'self' http://* 'unsafe-inline'; script-src 'self' http://* 'unsafe-inline' 'unsafe-eval'" />-->
    <meta http-equiv="Content-Security-Policy" content="
                            default-src * data: blob: ws: wss: gap://ready file://*;
                            style-src * 'unsafe-inline'; 
                            script-src * 'unsafe-inline' 'unsafe-eval';
                            connect-src * ws: wss:;">
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
    <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline'; style-src 'self' 'unsafe-inline'; media-src"/>
</head>


<body>

    <h1>Node.js api </h1>
   <form onsubmit="return validateNodeForm()" name="nodeForm" id="nodeFormId">
       <label for="name">Please input a string</label>
       <input type="text" name="input" id="name">
       <h6 id="err"></h6>
       <input type="submit" value="send">
       <p id="nodeHashed">
        response
    </p>
   </form>

  
   

   <h1>Go api</h1>
   <form onsubmit="return validateGoForm()" name="goForm" id="goFormId">
    <label for="name2">Please input a string</label>
    <input type="text" name="input" id="name2">
    <h6 id="err2"></h6>
    <input type="submit" value="send">
    <p id="goHashed">
        response
    </p>
</form>

<script>
    var goValidated = true;
    var nodeValidated = true;

    var form = document.getElementById("goFormId");
    form.addEventListener("submit", handleGoForm);

    var form1 = document.getElementById("nodeFormId");
    form1.addEventListener("submit", handleNodeForm);

    function validateNodeForm(){
        let x = document.forms["nodeForm"]["input"].value;


        if (x.length < 8){
             document.getElementById("err").innerHTML = "Input could not be less than 8 characters!";
             nodeValidated = false;
             return false;
        }
    }

    function validateGoForm(){
        let x = document.forms["goForm"]["input"].value;


        if (x.length < 8){
             document.getElementById("err2").innerHTML = "Input could not be less than 8 characters!";
             goValidated = false;
             return false;
        }
        var data = new FormData(document.forms["goForm"])
        data.append("input", "x");

     // var http = new XMLHttpRequest();
     // var url = '/go/sha256';
     // var params = 'input=sara';

     // http.open('POST', url , true);

     // http.onreadystatechange = function(){
     //     if (http.readyState == 4 && http.status == 200){
     //         console.log("done")
     //     }
     // }


    }


    function handleGoForm(event){
        event.preventDefault();
        if(goValidated) {
            const data = new FormData();
        data.append("input", document.forms["goForm"]["input"].value);
           fetch("http://localhost/go/sha256/" , {
            method: 'POST',
            body: data,
            mode: 'no-cors',
            referrer: "",
            contentType: 'application/x-www-form-urlencoded; charset = UTF-8',
            dataType: 'json'
        }).then(r => r.json())
        .then(data => {
            console.log(data);
            document.getElementById("goHashed").innerHTML = data.message;
        })
        }
    }

    function handleNodeForm(event){
        event.preventDefault();
        if(nodeValidated) {
            const data = new FormData();
            data.append("input", document.forms["nodeForm"]["input"].value);
            console.log("input", document.forms["nodeForm"]["input"].value);
        //    fetch("http://localhost:3000/" , {
        //     method: "POST",
        //     body: data
        // }).then(r => r.json())
        //     .then(data => {
        //     console.log(data.message);
        
        //     document.getElementById("nodeHashed").innerHTML = data.message;
        // })

        fetch('http://localhost/node/sha256/', {
        method: 'POST',
        body: new URLSearchParams({
            'input': document.forms["nodeForm"]["input"].value
        })
    })
    .then(r => r.json())
    .then(data => {
            console.log(data);
            document.getElementById("nodeHashed").innerHTML = data.message;
        });
        }
    }
</script>

</body>
</html>
